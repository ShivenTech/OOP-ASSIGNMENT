package main;

import car.Car;
import customer.Customer;
import rental.Rental;
import java.util.ArrayList;
import java.util.Scanner;
import java.util.InputMismatchException;

public class Main {
    
    static ArrayList<Car> carList = new ArrayList<>();
    static ArrayList<Customer> customerList = new ArrayList<>();
    static ArrayList<Rental> rentalList = new ArrayList<>();
    static Scanner scanner = new Scanner(System.in);

    public static void main(String[] args) {
        
        initializeDummyData();
        
        boolean running = true;
        while (running) {
            System.out.println("\n=== CAR RENTAL MANAGEMENT SYSTEM ===");
            System.out.println("1. Rent a Car");
            System.out.println("2. Return a Car");
            System.out.println("3. View All Rentals");
            System.out.println("4. View All Available Cars");
            System.out.println("5. Exit System");
            System.out.print("Please select an option (1-5): ");
            
            try {
                int choice = scanner.nextInt();
                switch (choice) {
                    case 1: rentCar(); break;
                    case 2: returnCar(); break;
                    case 3: viewAllRentals(); break;
                    case 4: viewAvailableCars(); break;
                    case 5: 
                        System.out.println("Exiting the system. Goodbye!");
                        running = false; 
                        break;
                    default: System.out.println("Invalid option. Please choose between 1 and 5.");
                }
            } catch (InputMismatchException e) {
                System.out.println("Error: Please enter a number, not text.");
                scanner.nextLine(); 
            }
        }
    }

    public static void rentCar() {
        System.out.println("\n--- RENT A CAR ---");
        try {
            System.out.print("Enter Customer ID: ");
            String custId = scanner.next();
            Customer selectedCustomer = null;

            for (Customer c : customerList) {
                if (c.getCustomerId().equalsIgnoreCase(custId)) {
                    selectedCustomer = c;
                    break;
                }
            }

            if (selectedCustomer == null) {
                System.out.println("Error: Customer not found. Please register the customer first.");
                return; 
            }

            System.out.print("Enter Car Plate Number (e.g., ABC1233): ");
            String plate = scanner.next();
            Car selectedCar = null;

            for (Car car : carList) {
                if (car.getPlateNum().equalsIgnoreCase(plate)) {
                    selectedCar = car;
                    break;
                }
            }

            if (selectedCar == null) {
                System.out.println("Error: Car not found in the system.");
                return;
            }

            if (!selectedCar.isAvailable()) {
                System.out.println("Sorry, the car " + selectedCar.getPlateNum() + " is currently rented out.");
                return;
            }

            System.out.print("Enter number of days to rent: ");
            int days = scanner.nextInt(); 

            if (days <= 0) {
                System.out.println("Error: Rental days must be at least 1.");
                return;
            }

            String newRentalId = "R" + (rentalList.size() + 1001); 
            Rental newRental = new Rental(newRentalId, selectedCar, selectedCustomer, days);

            rentalList.add(newRental);
            selectedCar.setAvailable(false); 

            System.out.println("\nSUCCESS: Car successfully rented!");
            newRental.printReceipt();

        } catch (InputMismatchException e) {
            System.out.println("Error: Invalid input. Please enter valid numbers where required.");
            scanner.nextLine(); 
        } catch (Exception e) {
            System.out.println("An unexpected error occurred: " + e.getMessage());
        }
    }

    public static void returnCar() {
        System.out.println("\n--- RETURN A CAR ---");
        System.out.print("Enter Rental ID (e.g., R1001): ");
        String rentId = scanner.next();

        Rental rentalToReturn = null;
        for (Rental r : rentalList) {
            if (r.getRentalId().equalsIgnoreCase(rentId)) {
                rentalToReturn = r;
                break;
            }
        }

        if (rentalToReturn == null) {
            System.out.println("Error: Rental ID not found.");
            return;
        }

        if (!rentalToReturn.isActive()) {
            System.out.println("Notice: This rental has already been completed and returned.");
            return;
        }

        rentalToReturn.returnCar(); 
        rentalToReturn.getRentedCar().setAvailable(true); 

        System.out.println("SUCCESS: Car " + rentalToReturn.getRentedCar().getPlateNum() + " has been returned.");
        System.out.println("The vehicle is now available for rent again.");
    }

    public static void viewAllRentals() {
        System.out.println("\n--- ALL RENTAL TRANSACTIONS ---");
        if (rentalList.isEmpty()) {
            System.out.println("No rentals found in the system.");
            return;
        }

        System.out.printf("%-10s %-15s %-15s %-10s %-10s %-10s\n", 
                          "Rental ID", "Customer ID", "Car Plate", "Days", "Total(RM)", "Status");
        System.out.println("-------------------------------------------------------------------------");
        
        for (Rental r : rentalList) {
            String status = r.isActive() ? "Active" : "Returned";
            System.out.printf("%-10s %-15s %-15s %-10d %-10.2f %-10s\n", 
                              r.getRentalId(), r.getRenter().getCustomerId(), 
                              r.getRentedCar().getPlateNum(), r.getRentalDays(), 
                              r.getTotalCost(), status);
        }
    }
    
    // Quick method to display the cars so you can see your teammate's list
    public static void viewAvailableCars() {
        System.out.println("\n--- AVAILABLE CARS ---");
        System.out.printf("%-10s %-12s %-15s %-10s\n", "Plate", "Brand", "Model", "Rate/Day");
        System.out.println("---------------------------------------------------");
        for (Car car : carList) {
            if (car.isAvailable()) {
                System.out.printf("%-10s %-12s %-15s RM%-10.2f\n", 
                        car.getPlateNum(), car.getBrand(), car.getModel(), car.getDailyrate());
            }
        }
    }

    public static void initializeDummyData() {
        // Friend 2's Car Data
        carList.add(new Car(101, "ABC1233", "Toyota", "Vios", 2023, 45.0, 'A', true, 5000, "Economy", 200.0));
        carList.add(new Car(102, "DEF4561", "Honda", "City", 2023, 48.0, 'A', true, 6000, "Economy", 200.0));
        carList.add(new Car(201, "MNO3453", "Toyota", "Fortuner", 2024, 120.0, 'A', true, 2000, "SUV", 500.0));
        carList.add(new Car(301, "YZA5637", "Mercedes", "C-Class", 2024, 200.0, 'A', true, 1000, "Luxury", 1000.0));
        
        // Friend 1's Customer Data
        customerList.add(new Customer("C001", "Ali Bin Abu", "L987654", "0123456789", "ali@email.com"));
        customerList.add(new Customer("C002", "Siti Nurhaliza", "L112233", "0198765432", "siti@email.com"));
        
        System.out.println("System initialized with dummy data from all teammates!");
    }
}

